<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Open.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">BackPacks</a> &gt; <a href="index.source.html" class="el_package">at.michael1011.backpacks.commads</a> &gt; <span class="el_source">Open.java</span></div><h1>Open.java</h1><pre class="source lang-java linenums">package at.michael1011.backpacks.commads;

import at.michael1011.backpacks.Crafting;
import at.michael1011.backpacks.Main;
import at.michael1011.backpacks.SQL;
import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.command.Command;
import org.bukkit.command.CommandExecutor;
import org.bukkit.command.CommandSender;
import org.bukkit.command.PluginCommand;
import org.bukkit.entity.Player;
import org.bukkit.inventory.ItemStack;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Map;

import static at.michael1011.backpacks.Crafting.itemsInverted;
import static at.michael1011.backpacks.Crafting.type;
import static at.michael1011.backpacks.Main.messages;
import static at.michael1011.backpacks.Main.prefix;
import static at.michael1011.backpacks.listeners.RightClick.getInv;

public class Open implements CommandExecutor {

<span class="nc" id="L27">    public Open(Main main) {</span>
<span class="nc" id="L28">        PluginCommand command = main.getCommand(&quot;bpopen&quot;);</span>

<span class="nc" id="L30">        command.setExecutor(this);</span>
<span class="nc" id="L31">        command.setTabCompleter(new OpenCompleter());</span>
<span class="nc" id="L32">    }</span>

    @Override
    public boolean onCommand(final CommandSender sender, Command command, String label, final String[] args) {
<span class="nc bnc" id="L36" title="All 2 branches missed.">        if(sender.hasPermission(&quot;backpacks.open&quot;)) {</span>
<span class="nc bnc" id="L37" title="All 2 branches missed.">            if(args.length == 2) {</span>
<span class="nc" id="L38">                final String backPack = args[0];</span>
<span class="nc" id="L39">                final String finalType = type.get(backPack);</span>
<span class="nc" id="L40">                final String player = args[1];</span>

<span class="nc" id="L42">                final ItemStack item = itemsInverted.get(backPack);</span>

<span class="nc bnc" id="L44" title="All 2 branches missed.">                if(item != null) {</span>
<span class="nc" id="L45">                    SQL.getResult(&quot;SELECT * FROM bp_users WHERE name='&quot;+player+&quot;'&quot;, new SQL.Callback&lt;ResultSet&gt;() {</span>
                        @Override
                        public void onSuccess(ResultSet rs) {
                            try {
<span class="nc" id="L49">                                rs.beforeFirst();</span>

<span class="nc bnc" id="L51" title="All 2 branches missed.">                                if(rs.next()) {</span>
<span class="nc" id="L52">                                    final String trimmedID = rs.getString(&quot;uuid&quot;);</span>

<span class="nc bnc" id="L54" title="All 18 branches missed.">                                    switch (finalType) {</span>
                                        case &quot;normal&quot;:
<span class="nc bnc" id="L56" title="All 2 branches missed.">                                            if(sender instanceof Player) {</span>
<span class="nc" id="L57">                                                final Player opener = (Player) sender;</span>

<span class="nc" id="L59">                                                SQL.checkTable(&quot;bp_&quot;+backPack+&quot;_&quot;+trimmedID, new SQL.Callback&lt;Boolean&gt;() {</span>
                                                    @Override
                                                    public void onSuccess(Boolean rs) {
<span class="nc bnc" id="L62" title="All 2 branches missed.">                                                        if(rs) {</span>
<span class="nc" id="L63">                                                            SQL.getResult(&quot;SELECT * FROM bp_&quot;+backPack+&quot;_&quot;+trimmedID, new SQL.Callback&lt;ResultSet&gt;() {</span>
                                                                @Override
                                                                public void onSuccess(ResultSet rs) {
<span class="nc" id="L66">                                                                    opener.openInventory(getInv(rs, opener, backPack, item.getItemMeta().getDisplayName(), false, trimmedID));</span>
<span class="nc" id="L67">                                                                }</span>

                                                                @Override
<span class="nc" id="L70">                                                                public void onFailure(Throwable e) {}</span>

                                                                });

                                                        } else {
<span class="nc" id="L75">                                                            sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                                                                    messages.getString(&quot;Help.bpopen.hasNotUsedYet&quot;)
                                                                            .replaceAll(&quot;%player%&quot;, player).replaceAll(&quot;%backpack%&quot;, backPack)));
                                                        }

<span class="nc" id="L80">                                                    }</span>

                                                    @Override
<span class="nc" id="L83">                                                    public void onFailure(Throwable e) {}</span>

                                                });

<span class="nc" id="L87">                                            } else {</span>
<span class="nc" id="L88">                                                sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                                                        messages.getString(&quot;Help.bpopen.onlyPlayers&quot;).replaceAll(&quot;%type%&quot;, finalType)));
                                            }

<span class="nc" id="L92">                                            break;</span>

                                        case &quot;ender&quot;:
<span class="nc" id="L95">                                            Player target = Bukkit.getPlayer(player);</span>

<span class="nc bnc" id="L97" title="All 2 branches missed.">                                            if(sender instanceof Player) {</span>
<span class="nc" id="L98">                                                final Player opener = (Player) sender;</span>

<span class="nc bnc" id="L100" title="All 2 branches missed.">                                                if(target != null) {</span>
<span class="nc" id="L101">                                                    opener.openInventory(target.getEnderChest());</span>

                                                } else {
<span class="nc" id="L104">                                                    sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                                                            messages.getString(&quot;Help.bpopen.hasNotUsedYet&quot;)
                                                                    .replaceAll(&quot;%player%&quot;, player).replaceAll(&quot;%backpack%&quot;, backPack)));
                                                }

<span class="nc" id="L109">                                            }  else {</span>
<span class="nc" id="L110">                                                sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                                                        messages.getString(&quot;Help.bpopen.onlyPlayers&quot;).replaceAll(&quot;%type%&quot;, finalType)));
                                            }

<span class="nc" id="L114">                                            break;</span>

                                        case &quot;furnace&quot;:
<span class="nc" id="L117">                                            SQL.getResult(&quot;SELECT * FROM bp_furnaces WHERE uuid='&quot;+trimmedID+&quot;'&quot;, new SQL.Callback&lt;ResultSet&gt;() {</span>
                                                @Override
                                                public void onSuccess(ResultSet rs) {
                                                    try {
<span class="nc" id="L121">                                                        rs.beforeFirst();</span>

<span class="nc bnc" id="L123" title="All 2 branches missed.">                                                        if(rs.next()) {</span>
<span class="nc" id="L124">                                                            String ores = rs.getString(&quot;ores&quot;);</span>
<span class="nc" id="L125">                                                            String food = rs.getString(&quot;food&quot;);</span>
<span class="nc" id="L126">                                                            String autoFill = rs.getString(&quot;autoFill&quot;);</span>

<span class="nc" id="L128">                                                            sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                                                                    messages.getString(&quot;BackPacks.furnaceBackPack.open.title&quot;)
                                                                            .replaceAll(&quot;%target%&quot;, player).replaceAll(&quot;%backpack%&quot;, backPack)));

<span class="nc" id="L132">                                                            sender.sendMessage(prefix);</span>

<span class="nc" id="L134">                                                            sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                                                                    messages.getString(&quot;BackPacks.furnaceBackPack.open.ores&quot;)
                                                                            .replaceAll(&quot;%value%&quot;, getColor(Boolean.valueOf(ores))+ores)));

<span class="nc" id="L138">                                                            sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                                                                    messages.getString(&quot;BackPacks.furnaceBackPack.open.food&quot;)
                                                                            .replaceAll(&quot;%value%&quot;, getColor(Boolean.valueOf(food))+food)));

<span class="nc" id="L142">                                                            sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                                                                    messages.getString(&quot;BackPacks.furnaceBackPack.open.autoFill&quot;)
                                                                            .replaceAll(&quot;%value%&quot;, getColor(Boolean.valueOf(autoFill))+autoFill)));

<span class="nc" id="L146">                                                            sender.sendMessage(prefix);</span>

<span class="nc" id="L148">                                                            sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                                                                    messages.getString(&quot;BackPacks.furnaceBackPack.open.coal&quot;)
                                                                            .replaceAll(&quot;%value%&quot;, String.valueOf(rs.getInt(&quot;coal&quot;)))));

<span class="nc" id="L152">                                                        } else {</span>
<span class="nc" id="L153">                                                            sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                                                                    messages.getString(&quot;Help.bpopen.hasNotUsedYet&quot;)
                                                                            .replaceAll(&quot;%player%&quot;, player).replaceAll(&quot;%backpack%&quot;, backPack)));
                                                        }

<span class="nc" id="L158">                                                        rs.close();</span>

<span class="nc" id="L160">                                                    } catch (SQLException e) {</span>
<span class="nc" id="L161">                                                        e.printStackTrace();</span>
<span class="nc" id="L162">                                                    }</span>

<span class="nc" id="L164">                                                }</span>

                                                @Override
<span class="nc" id="L167">                                                public void onFailure(Throwable e) {}</span>

                                            });

<span class="nc" id="L171">                                            break;</span>

                                        case &quot;crafting&quot;:
<span class="nc" id="L174">                                            sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;', messages.getString(&quot;Help.bpopen.craftingBackPack&quot;)));</span>

                                            break;
                                    }

<span class="nc" id="L179">                                } else {</span>
<span class="nc" id="L180">                                    sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                                                messages.getString(&quot;Help.playerNotFound&quot;).replaceAll(&quot;%target%&quot;, player)));
                                }

<span class="nc" id="L184">                            } catch (SQLException e) {</span>
<span class="nc" id="L185">                                e.printStackTrace();</span>
<span class="nc" id="L186">                            }</span>
<span class="nc" id="L187">                        }</span>

                        @Override
<span class="nc" id="L190">                        public void onFailure(Throwable e) {}</span>

                    });

                } else {
<span class="nc" id="L195">                    sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                            messages.getString(&quot;Help.backPackNotFound&quot;).replaceAll(&quot;%backpack%&quot;, backPack)));

<span class="nc" id="L198">                    sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;',</span>
                            messages.getString(&quot;Help.backPackNotFoundAvailable&quot;)
                                    .replaceAll(&quot;%backpacks%&quot;, Crafting.available.replaceAll(&quot;,&quot;, &quot;, &quot;))));
                }

<span class="nc" id="L203">            } else {</span>
<span class="nc" id="L204">                Map&lt;String, Object&gt; syntaxError = messages.getConfigurationSection(&quot;Help.bpopen.syntaxError&quot;).getValues(true);</span>

<span class="nc bnc" id="L206" title="All 2 branches missed.">                for(Map.Entry&lt;String, Object&gt; error : syntaxError.entrySet()) {</span>
<span class="nc" id="L207">                    sender.sendMessage(prefix+ChatColor.translateAlternateColorCodes('&amp;', (String) error.getValue()));</span>
<span class="nc" id="L208">                }</span>

<span class="nc" id="L210">            }</span>

        } else {
<span class="nc" id="L213">            sender.sendMessage(prefix+ ChatColor.translateAlternateColorCodes('&amp;',</span>
                    messages.getString(&quot;Help.noPermission&quot;)));
        }

<span class="nc" id="L217">        return true;</span>
    }


    private String getColor(Boolean bool) {
<span class="nc bnc" id="L222" title="All 2 branches missed.">        if(bool) {</span>
<span class="nc" id="L223">            return &quot;&amp;a&quot;;</span>
        }

<span class="nc" id="L226">        return &quot;&amp;c&quot;;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>